<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™æ€èµ„æºæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-box {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .success {
            color: #52c41a;
            font-weight: bold;
        }

        .error {
            color: #ff4d4f;
            font-weight: bold;
        }

        h1 {
            color: #ff6b35;
        }

        .info {
            background: #e6f7ff;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <div class="test-box">
        <h1>ğŸ” é™æ€èµ„æºåŠ è½½æµ‹è¯•</h1>

        <div class="info">
            <p><strong>å¦‚æœä½ èƒ½çœ‹åˆ°è¿™ä¸ªé¡µé¢æœ‰æ ·å¼ï¼ˆç™½è‰²èƒŒæ™¯ã€åœ†è§’ã€é˜´å½±ï¼‰ï¼Œè¯´æ˜å†…è” CSS å¯ä»¥å·¥ä½œã€‚</strong></p>
        </div>

        <h2>æµ‹è¯•ç»“æœ:</h2>
        <div id="results">
            <p>æ­£åœ¨æµ‹è¯•...</p>
        </div>

        <h2>å½“å‰é¡µé¢ä¿¡æ¯:</h2>
        <pre id="pageInfo"></pre>

        <h2>è§£å†³æ–¹æ¡ˆ:</h2>
        <div id="solutions"></div>
    </div>

    <script>
        // æ˜¾ç¤ºé¡µé¢ä¿¡æ¯
        document.getElementById('pageInfo').textContent = `
URL: ${window.location.href}
åè®®: ${window.location.protocol}
ä¸»æœº: ${window.location.host}
è·¯å¾„: ${window.location.pathname}
User Agent: ${navigator.userAgent}
        `.trim();

        async function testResources() {
            const results = document.getElementById('results');
            const solutions = document.getElementById('solutions');
            results.innerHTML = '';
            solutions.innerHTML = '';

            const tests = [
                { name: 'styles.css', url: '/styles.css' },
                { name: 'script.js', url: '/script.js' },
                { name: 'favicon.svg', url: '/favicon.svg' },
                { name: 'API Health', url: '/api/health' },
                { name: 'API Contents', url: '/api/contents' }
            ];

            let allPassed = true;
            const failedTests = [];

            for (const test of tests) {
                try {
                    const response = await fetch(test.url);
                    const status = response.status;
                    const isSuccess = status === 200;

                    if (!isSuccess) allPassed = false;

                    const resultDiv = document.createElement('div');
                    resultDiv.innerHTML = `
                        <p class="${isSuccess ? 'success' : 'error'}">
                            ${isSuccess ? 'âœ…' : 'âŒ'} ${test.name}: ${status} ${response.statusText}
                        </p>
                    `;
                    results.appendChild(resultDiv);

                    if (!isSuccess) {
                        failedTests.push({ name: test.name, status, url: test.url });
                    }

                    // å¯¹äº APIï¼Œæ˜¾ç¤ºè¿”å›å†…å®¹
                    if (test.url.startsWith('/api/') && isSuccess) {
                        try {
                            const data = await response.json();
                            const dataDiv = document.createElement('pre');
                            dataDiv.textContent = JSON.stringify(data, null, 2);
                            dataDiv.style.fontSize = '12px';
                            dataDiv.style.maxHeight = '200px';
                            dataDiv.style.overflow = 'auto';
                            results.appendChild(dataDiv);
                        } catch (e) {
                            // å¿½ç•¥ JSON è§£æé”™è¯¯
                        }
                    }
                } catch (error) {
                    allPassed = false;
                    failedTests.push({ name: test.name, error: error.message });

                    const resultDiv = document.createElement('div');
                    resultDiv.innerHTML = `
                        <p class="error">âŒ ${test.name}: è¯·æ±‚å¤±è´¥ - ${error.message}</p>
                    `;
                    results.appendChild(resultDiv);
                }
            }

            // æ˜¾ç¤ºè§£å†³æ–¹æ¡ˆ
            if (!allPassed) {
                solutions.innerHTML = `
                    <div style="background: #fff2f0; padding: 20px; border-radius: 8px; border-left: 4px solid #ff4d4f;">
                        <h3 style="color: #ff4d4f; margin-top: 0;">âš ï¸ æ£€æµ‹åˆ°é—®é¢˜</h3>
                        <p><strong>å¤±è´¥çš„æµ‹è¯•:</strong></p>
                        <ul>
                            ${failedTests.map(t => `<li>${t.name} ${t.status ? `(${t.status})` : ''} ${t.error ? `- ${t.error}` : ''}</li>`).join('')}
                        </ul>
                        
                        <h4>å¯èƒ½çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆ:</h4>
                        <ol>
                            <li><strong>Vercel æ„å»ºç¼“å­˜é—®é¢˜</strong>
                                <ul>
                                    <li>ç™»å½• Vercel æ§åˆ¶å°</li>
                                    <li>è¿›å…¥ Settings â†’ General</li>
                                    <li>å‘ä¸‹æ»šåŠ¨æ‰¾åˆ° "Build & Development Settings"</li>
                                    <li>ç‚¹å‡» "Clear Build Cache"</li>
                                    <li>ç„¶ååœ¨ Deployments é¡µé¢ç‚¹å‡» "Redeploy"</li>
                                </ul>
                            </li>
                            <li><strong>ç¯å¢ƒå˜é‡æœªé…ç½®</strong> (å¦‚æœ API å¤±è´¥)
                                <ul>
                                    <li>è¿›å…¥ Settings â†’ Environment Variables</li>
                                    <li>ç¡®ä¿é…ç½®äº†: FEISHU_APP_ID, FEISHU_APP_SECRET, FEISHU_APP_TOKEN, FEISHU_TABLE_ID</li>
                                    <li>é…ç½®åéœ€è¦é‡æ–°éƒ¨ç½²</li>
                                </ul>
                            </li>
                            <li><strong>é™æ€æ–‡ä»¶è·¯ç”±é—®é¢˜</strong> (å¦‚æœ CSS/JS å¤±è´¥)
                                <ul>
                                    <li>ç¡®è®¤ vercel.json æ–‡ä»¶å·²æ›´æ–°</li>
                                    <li>æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åœ¨é¡¹ç›®æ ¹ç›®å½•</li>
                                    <li>å°è¯•åˆ é™¤ .vercel æ–‡ä»¶å¤¹åé‡æ–°éƒ¨ç½²</li>
                                </ul>
                            </li>
                        </ol>

                        <h4>ç«‹å³å°è¯•:</h4>
                        <p>åœ¨ Vercel æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p>
                        <pre style="background: #000; color: #0f0; padding: 15px; border-radius: 4px;">
# 1. æ¸…é™¤æ„å»ºç¼“å­˜
Settings â†’ General â†’ Clear Build Cache

# 2. å¼ºåˆ¶é‡æ–°éƒ¨ç½²
Deployments â†’ æœ€æ–°éƒ¨ç½² â†’ ... â†’ Redeploy

# 3. å‹¾é€‰ "Use existing Build Cache" ä¸º OFF
                        </pre>
                    </div>
                `;
            } else {
                solutions.innerHTML = `
                    <div style="background: #f6ffed; padding: 20px; border-radius: 8px; border-left: 4px solid #52c41a;">
                        <h3 style="color: #52c41a; margin-top: 0;">âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡!</h3>
                        <p>é™æ€èµ„æºå’Œ API éƒ½æ­£å¸¸å·¥ä½œã€‚å¦‚æœä¸»é¡µä»ç„¶æœ‰é—®é¢˜ï¼Œè¯·:</p>
                        <ol>
                            <li>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ (Ctrl+Shift+R æˆ– Cmd+Shift+R)</li>
                            <li>å°è¯•æ— ç—•æ¨¡å¼è®¿é—®</li>
                            <li>æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å° (F12) æ˜¯å¦æœ‰ JavaScript é”™è¯¯</li>
                        </ol>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', testResources);
    </script>
</body>

</html>